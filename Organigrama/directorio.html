<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Directorio LAV ESTE</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/@tailwindcss/typography@0.5.9/dist/typography.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@10.2.7/dist/autoComplete.min.js"></script>
    <style>
        header {
            background: linear-gradient(to right, #e0f7f7, #008080, #e0f7f7); /* Fondo degradado con tonos verde azulado */
            color: #333; /* Color de texto oscuro por defecto para mejor contraste */
            padding: 20px; /* Añadir padding */
            text-align: center; /* Centrar texto */
        }

        header a {
            font-family: 'Montserrat', sans-serif;
            color: white; /* Título principal en blanco */
        }

        header h2 {
            font-family: 'Montserrat', sans-serif;
            color: #cccccc; /* Subtítulo en gris claro */
        }
        /* Estilos para los logos */
        .logo-adif {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 120px;
            height: auto;
            z-index: 20;
        }

        .logo-ineco {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 120px;
            height: auto;
            z-index: 20;
        }

        .adif-logo {
            background-image: url('https://www.adifaltavelocidad.es/documents/34745/2553140/Logo_Adif_AV_verde_351x170.png/aa356add-9b30-836e-8d9f-276eb02d17cf?t=1617203111419&download=true');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .ineco-logo {
            background-image: url('https://www.ineco.com/ineco/sites/default/files/2022-12/Logo%20Ineco.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .location-header {
            background: linear-gradient(90deg, rgba(0,82,147,1) 0%, rgba(0,128,128,1) 100%);
            color: white;
            transition: all 0.3s ease;
        }

        .location-header:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .contact-card {
            padding: 1.5rem;
            border-radius: 1rem;
            background-color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border-left: 6px solid #008080; /* Color por defecto para ADIF */
        }

        .contact-card.ineco {
            border-left: 6px solid #005293; /* Color específico para INECO */
        }

        .contact-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 12px rgba(0,0,0,0.1);
        }

        .company-logo {
            position: absolute;
            top: -1rem;
            right: 0;
            width: 6rem;
            height: 6rem;
            border-radius: 1rem;
        }

        .contact-avatar {
            width: 4rem;
            height: 4rem;
            border-radius: 50%;
            background-color: #008080;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .contact-avatar:hover {
            background-color: #005293;
            transform: scale(1.1);
        }

        .contact-info {
            margin-left: 1rem;
            flex: 1;
        }

        .contact-name {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .contact-position {
            color: #64748b;
            font-size: 0.875rem;
        }

        .contact-details {
            margin-top: 0.5rem;
            color: #64748b;
            font-size: 0.875rem;
        }

        .contact-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .badge-adif {
            background-color: #008080;
            color: white;
        }

        .badge-ineco {
            background-color: #2196F3;
            color: white;
        }

        .contact-card:hover {
            transform: translateY(-5px) rotateX(2deg);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
            background: rgba(255, 255, 255, 0.95);
        }

        .search-container {
            background: linear-gradient(135deg, #f0f9ff 0%, #e6f7ff 100%);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .search-input {
            @apply w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#005293] focus:border-[#005293] transition;
        }

        .search-suggestion {
            @apply px-3 py-1 bg-gray-100 text-sm rounded-full hover:bg-[#005293] hover:text-white transition cursor-pointer;
        }

        .contact-card {
            @apply p-4 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 bg-white;
        }

        .contact-card-header {
            @apply flex items-center justify-between mb-3;
        }

        .contact-avatar {
            @apply w-12 h-12 rounded-full flex items-center justify-center bg-[#008080] text-white text-xl font-bold;
        }

        .contact-info {
            @apply space-y-2;
        }

        .contact-details {
            @apply grid grid-cols-2 gap-2 text-sm;
        }

        .contact-detail-label {
            @apply font-medium text-gray-600;
        }

        .contact-detail-value {
            @apply text-gray-900;
        }

        .contact-actions {
            @apply flex gap-2 mt-4;
        }

        .action-button {
            @apply px-3 py-1 rounded-md text-sm hover:bg-gray-100 transition;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 relative">
        <header class="mb-10 text-center relative z-10">
            <!-- Logo ADIF -->
            <img src="https://www.adifaltavelocidad.es/documents/34745/2553140/Logo_Adif_AV_verde_351x170.png/aa356add-9b30-836e-8d9f-276eb02d17cf?t=1617203111419&download=true" alt="ADIF" class="logo-adif absolute top-0 left-0 w-48">
            <!-- Logo INECO -->
            <img src="https://www.ineco.com/ineco/sites/default/files/2022-12/Logo%20Ineco.png" alt="INECO" class="logo-ineco absolute top-0 right-0 w-44 h-21.5 mt-2">
            <a href="#" class="text-5xl font-bold text-[#005293] mb-2 hover:text-[#008080] transition-colors">MANTENIMIENTO LAV ESTE</a>
            <h2 class="text-3xl font-semibold text-[#008080]">Directorio de Conctatos</h2>
            <div class="w-24 h-1 bg-[#008080] mx-auto mt-4 rounded-full"></div>
        </header>

        <div class="flex justify-center mb-6 border border-gray-300 shadow-lg rounded-lg p-4">
            <div class="flex gap-4">
                <button onclick="window.location.href='index.html'" class="px-4 py-2 bg-[#008080] text-white rounded-md hover:bg-[#005293] transition-colors">
                    ORGANIGRAMA
                </button>
                <button onclick="window.location.href='mapa.html'" class="px-4 py-2 bg-[#008080] text-white rounded-md hover:bg-[#005293] transition-colors">
                    MAPA
                </button>
            </div>
        </div>

        <div class="search-container p-6 mb-10 shadow-md">
            <div class="flex flex-col md:flex-row gap-4 items-center">
                <div class="flex-1 w-full">
                    <label for="searchInput" class="block text-sm font-medium text-gray-700 mb-1">Buscar contacto:</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fas fa-search text-gray-400"></i>
                        </div>
                        <input type="text" id="searchInput" placeholder="Buscar por nombre, puesto, ubicación..."
                               class="pl-10 pr-10 w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#005293] focus:border-[#005293] transition">
                        <button type="button" id="clearSearch" class="absolute inset-y-0 right-0 w-8 h-8 flex items-center justify-center cursor-pointer text-gray-500 hover:text-red-500 transition-colors duration-200 rounded-r-lg border border-transparent hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#005293] focus:ring-offset-2">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="w-full md:w-auto">
                    <label for="locationFilter" class="block text-sm font-medium text-gray-700 mb-1">Filtrar por ubicación:</label>
                    <select id="locationFilter" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#005293] focus:border-[#005293] transition">
                        <option value="">Todas las ubicaciones</option>
                        <option value="Madrid - Paseo del Rey">Madrid - Paseo del Rey</option>
                        <option value="Villaverde">Villaverde</option>
                        <option value="Madrid Sur">Madrid Sur</option>
                        <option value="BM Villarrubia">BM Villarrubia</option>
                        <option value="BM Requena">BM Requena</option>
                        <option value="BM Gabaldón">BM Gabaldón</option>
                        <option value="BM Monforte">BM Monforte</option>
                        <option value="ET Albacete">ET Albacete</option>
                        <option value="Estación Valencia">Estación Valencia</option>
                        <option value="ET Valencia">ET Valencia</option>
                        <option value="CRC Albacete">CRC Albacete</option>
                    </select>
                </div>
            </div>
            <div class="mt-4 flex flex-wrap gap-2">
                <span class="text-sm text-gray-600 flex items-center">Sugerencias:</span>
                <!-- Roles -->
                <button class="search-suggestion px-3 py-1 bg-gray-100 text-sm rounded-full hover:bg-[#005293] hover:text-white transition">Jefe de Área</button>
                <button class="search-suggestion px-3 py-1 bg-gray-100 text-sm rounded-full hover:bg-[#005293] hover:text-white transition">Jefe de Base</button>
                <button class="search-suggestion px-3 py-1 bg-gray-100 text-sm rounded-full hover:bg-[#005293] hover:text-white transition">Jefe de Unidad</button>
                <button class="search-suggestion px-3 py-1 bg-gray-100 text-sm rounded-full hover:bg-[#005293] hover:text-white transition">Técnico de Infra y Vía</button>
                <button class="search-suggestion px-3 py-1 bg-gray-100 text-sm rounded-full hover:bg-[#005293] hover:text-white transition">Técnico Documentalista</button>
                <button class="search-suggestion px-3 py-1 bg-gray-100 text-sm rounded-full hover:bg-[#005293] hover:text-white transition">Teleco</button>
                <button class="search-suggestion px-3 py-1 bg-gray-100 text-sm rounded-full hover:bg-[#005293] hover:text-white transition">II.SS.</button>

                <!-- Empresas -->
                <button class="search-suggestion px-3 py-1 bg-gray-100 text-sm rounded-full hover:bg-[#005293] hover:text-white transition">INECO</button>
                <button class="search-suggestion px-3 py-1 bg-gray-100 text-sm rounded-full hover:bg-[#005293] hover:text-white transition">ADIF</button>

                <!-- Términos comunes -->
                <button class="search-suggestion px-3 py-1 bg-gray-100 text-sm rounded-full hover:bg-[#005293] hover:text-white transition">Coordinador</button>
                <button class="search-suggestion px-3 py-1 bg-gray-100 text-sm rounded-full hover:bg-[#005293] hover:text-white transition">C.T. Ingeniería Civil</button>
            </div>
        </div>

        <div id="contactsContainer">
            <div id="contactsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Contacts will be dynamically inserted here by JavaScript -->
            </div>
        </div>

        <div id="noResults" class="hidden text-center py-10">
            <i class="fas fa-search text-4xl text-gray-300 mb-4"></i>
            <h3 class="text-xl font-medium text-gray-500">No se encontraron resultados</h3>
            <p class="text-gray-400">Intenta con otros términos de búsqueda</p>
        </div>
    </div>

    <script type="module">
        // Función para generar avatar inicial
        function getAvatarInitials(name) {
            return name.split(' ').map(word => word[0].toUpperCase()).join('');
        }

        // Función para formatear el teléfono
        function formatPhone(phone) {
            return phone.replace(/(\d{3})(\d{3})(\d{3})/, '$1 $2 $3');
        }

        let contacts = []; // Declare contacts variable here
        const searchInput = document.getElementById('searchInput');
        const clearSearch = document.getElementById('clearSearch');
        const locationFilter = document.getElementById('locationFilter');


        // Fetch data from unified_data.json
        fetch('./unified_data.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                // Flatten the data structure to get a single array of contacts
                contacts = data.flatMap(location => location.personas.map(person => ({
                    ...person,
                    ubicacion: location.nombre_centro // Add location to each person object
                })));
                renderContacts(); // Render contacts after data is loaded
                initializeAutoComplete(contacts); // Initialize autocomplete with loaded data
            })
            .catch(error => {
                console.error('Error fetching unified data:', error);
                document.getElementById('contactsContainer').innerHTML = '<p class="text-red-500 text-center">Error al cargar los datos de contacto.</p>';
            });

        // Function to initialize autocomplete (moved here to use fetched data)
        function initializeAutoComplete(contactsData) {
            const autoCompleteInstance = new autoComplete({
                data: {
                    src: function(term, suggest) {
                        const suggestions = contactsData.filter(contact => {
                            const normalize = (text) => text.normalize('NFD').replace(/[̀-ͯ]/g, '').toLowerCase();
                            const searchTerm = normalize(term);
                            return normalize(contact.nombre).includes(searchTerm) ||
                                   normalize(contact.puesto).includes(searchTerm) ||
                                   normalize(contact.ubicacion).includes(searchTerm) ||
                                   contact.telefono.includes(searchTerm);
                        }).map(contact => ({
                            value: contact.nombre,
                            text: `${contact.nombre} - ${contact.puesto}`
                        }));
                        suggest(suggestions);
                    }
                },
                selector: '#searchInput',
                threshold: 1,
                debounce: 300,
                highlight: true,
                maxResults: 10,
                onSelection: function(e, term, item) {
                    // Limpiamos el input y aplicamos el filtro
                    searchInput.value = term.value;
                    filterContacts();
                    // Actualizar el botón de limpiar inmediatamente
                    toggleClearButton();
                },
                searchEngine: "strict"
            });
        }


        // Ajustar el zoom inicial del navegador
        document.body.style.zoom = '90%';

        // Función para determinar la empresa del trabajador
        function getEmpresa(correo) {
            if (correo.includes('@ineco.com')) return 'ineco';
            if (correo.includes('@adif.es')) return 'adif';
            return 'adif'; // Por defecto ADIF si no se especifica
        }

        // Función para renderizar los contactos
        function renderContacts(filteredContacts = contacts) {
            const container = document.getElementById('contactsContainer');
            container.innerHTML = '';

            // Agrupar contactos por ubicación
            const groupedContacts = filteredContacts.reduce((acc, contact) => {
                if (!acc[contact.ubicacion]) {
                    acc[contact.ubicacion] = [];
                }
                // Si es Mario García Aguado, lo insertamos al principio
                if (contact.nombre === "Mario García Aguado") {
                    acc[contact.ubicacion].unshift(contact);
                } else {
                    acc[contact.ubicacion].push(contact);
                }
                return acc;
            }, {});

            const sortedLocations = Object.keys(groupedContacts).sort();

            sortedLocations.forEach(location => {
                const locationHeader = document.createElement('div');
                locationHeader.className = 'location-header p-4 rounded-lg shadow-md mb-6 cursor-pointer';
                locationHeader.innerHTML = `
                    <h3 class="text-xl font-bold text-white">${location}</h3>
                    <p class="text-white opacity-80">${groupedContacts[location].length} contacto${groupedContacts[location].length !== 1 ? 's' : ''}</p>
                `;
                container.appendChild(locationHeader);

                const contactsGrid = document.createElement('div');
                contactsGrid.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-10';

                // Ordenar contactos por nombre, manteniendo a Mario al principio si existe
                if (groupedContacts[location][0]?.nombre === "Mario García Aguado") {
                    const mario = groupedContacts[location].shift();
                    const sortedContacts = groupedContacts[location].sort((a, b) => a.nombre.localeCompare(b.nombre));
                    groupedContacts[location].unshift(mario);
                } else {
                    groupedContacts[location].sort((a, b) => a.nombre.localeCompare(b.nombre));
                }

                groupedContacts[location].forEach(contact => {
                    const contactCard = document.createElement('div');
                    contactCard.className = `contact-card ${getEmpresa(contact.correo)} bg-white p-6 rounded-lg shadow-sm animate-fade-in`;
                    contactCard.innerHTML = `
                        <div class="flex items-start">
                            <div class="rounded-full w-12 h-12 flex items-center justify-center mr-4 ${getEmpresa(contact.correo) === 'adif' ? 'bg-[#008080]' : 'bg-[#2196F3]'}">
                                <i class="fas fa-user text-xl text-white"></i>
                            </div>
                            <div class="company-logo ${getEmpresa(contact.correo) === 'adif' ? 'adif-logo' : 'ineco-logo'}"></div>
                            <div class="contact-info">
                                <div class="contact-name">${contact.nombre}</div>
                                <div class="contact-position">${contact.puesto}</div>
                                <div class="contact-details">
                                    <div class="flex flex-wrap gap-2 mt-2">
                                        <span class="contact-badge ${getEmpresa(contact.correo) === 'adif' ? 'badge-adif' : 'badge-ineco'}">${getEmpresa(contact.correo).toUpperCase()}</span>
                                        <span class="contact-badge badge-ineco">${contact.ubicacion}</span>
                                    </div>
                                    <div class="mt-2">
                                        <i class="fas fa-envelope text-gray-500 mr-1"></i>
                                        <a href="mailto:${contact.correo}" class="text-blue-600 hover:text-blue-800">${contact.correo}</a>
                                    </div>
                                    <div>
                                        <i class="fas fa-phone text-gray-500 mr-1"></i>
                                        <span>${contact.telefono}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    contactsGrid.appendChild(contactCard);
                });

                container.appendChild(contactsGrid);
            });

            // Mostrar u ocultar el mensaje de "No se encontraron resultados"
            const noResultsDiv = document.getElementById('noResults');
            if (filteredContacts.length === 0) {
                noResultsDiv.classList.remove('hidden');
            } else {
                noResultsDiv.classList.add('hidden');
            }
        }

        // Función para filtrar contactos (actualizada para usar la variable global contacts)
        function filterContacts() {
            const searchTerm = searchInput.value.trim().toLowerCase();
            const locationTerm = locationFilter.value;

            const filtered = contacts.filter(contact => {
                const locationMatch = locationTerm === '' || contact.ubicacion === locationTerm;

                if (!searchTerm) return locationMatch;

                const normalize = (text) => text.normalize('NFD').replace(/[̀-ͯ]/g, '').toLowerCase();
                const normalizedSearchTerm = normalize(searchTerm);

                return locationMatch && (
                    normalize(contact.nombre).includes(normalizedSearchTerm) ||
                    normalize(contact.puesto).includes(normalizedSearchTerm) ||
                    normalize(contact.ubicacion).includes(normalizedSearchTerm) ||
                    contact.telefono.includes(normalizedSearchTerm) ||
                    normalize(getEmpresa(contact.correo)).includes(normalizedSearchTerm) // Incluir búsqueda por empresa
                );
            });

            renderContacts(filtered);
        }

        // Aseguramos que el botón esté visible inicialmente (si hay texto)
        toggleClearButton();

        // Añadir event listeners para búsqueda y filtro
        searchInput.addEventListener('input', filterContacts);
        locationFilter.addEventListener('change', filterContacts);

        // Añadir event listeners para los botones de sugerencia
        document.querySelectorAll('.search-suggestion').forEach(button => {
            button.addEventListener('click', () => {
                searchInput.value = button.textContent;
                filterContacts();
                toggleClearButton();
            });
        });

        // Mostrar/ocultar botón de limpiar según si hay texto
        function toggleClearButton() {
            if (searchInput.value.trim()) {
                clearSearch.style.display = 'flex';
                clearSearch.style.opacity = '1';
            } else {
                clearSearch.style.display = 'flex';
                clearSearch.style.opacity = '0';
            }
        }

        searchInput.addEventListener('input', toggleClearButton);

        // Limpiar búsqueda
        clearSearch.addEventListener('click', () => {
            searchInput.value = '';
            toggleClearButton();
            filterContacts();
        });

        // Actualizar el botón de limpiar cuando se selecciona un filtro predefinido
        document.querySelectorAll('.search-suggestion').forEach(button => {
            button.addEventListener('click', () => {
                toggleClearButton();
            });
        });

        // Inicializar estado del botón
        toggleClearButton();

    </script>
</body>
</html>
